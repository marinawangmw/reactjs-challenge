{"ast":null,"code":"import ApolloClient, { gql } from 'apollo-boost';\nimport { CLEAR_COLLECTION, CLEAR_ERROR, CLEAR_INPUT, Filter, GET_COLLECTION_ERROR, GET_COLLECTION_PENDING, GET_COLLECTION_SUCCESS, SET_CURRENT_PAGE, SET_FILTER, SET_NAME, SET_TOTAL_PAGES, SET_TYPE } from './reduxTypes';\nlet client = new ApolloClient({\n  uri: \"https://rickandmortyapi.com/graphql\"\n}); // GraphQL Queries\n\nconst queries = {\n  [Filter.characters]: `\n        query($name:String,$type:String, $page:Int) {\n            characters(page:$page,filter:{name:$name, type:$type}){\n                info{\n                    pages\n                }\n                results{\n                    id\n                    name\n                    type\n                    species\n                    gender\n                    image\n                }\n            }\n        }`,\n  [Filter.locations]: `\n        query($name:String,$type:String, $page:Int) {\n            locations(page:$page,filter:{name:$name, type:$type}){\n                info{\n                    pages\n                }\n                results{\n                    id\n                    name\n                    dimension\n                    residents{\n                        name\n                        image\n                    }\n                }\n            }\n        }`,\n  [Filter.episodes]: `\n        query($name:String, $page:Int) {\n            episodes(page:$page,filter:{name:$name}){\n                info{\n                    pages\n                }\n                results{\n                    id\n                    name\n                    air_date\n                    episode\n                    characters{\n                    name\n                    image\n                    }\n                }\n            }\n        }`\n}; // STATES\n\nconst initialData = {\n  filterQuery: '',\n  filter: Filter.characters,\n  collection: [],\n  inputType: '',\n  inputName: '',\n  fetching: false,\n  error: false,\n  page: 1,\n  totalPages: 0\n}; // REDUCER\n\nconst reducer = (state = initialData, action) => {\n  switch (action.type) {\n    case SET_FILTER:\n      return { ...state,\n        ...action.payload\n      };\n\n    case SET_NAME:\n      return { ...state,\n        inputName: action.payload\n      };\n\n    case SET_TYPE:\n      return { ...state,\n        inputType: action.payload\n      };\n\n    case CLEAR_INPUT:\n      return { ...state,\n        inputType: '',\n        inputName: ''\n      };\n\n    case CLEAR_COLLECTION:\n      return { ...state,\n        collection: [],\n        totalPages: 0\n      };\n\n    case CLEAR_ERROR:\n      return { ...state,\n        error: false\n      };\n\n    case SET_TOTAL_PAGES:\n      return { ...state,\n        totalPages: action.payload\n      };\n\n    case SET_CURRENT_PAGE:\n      return { ...state,\n        page: action.payload\n      };\n\n    case GET_COLLECTION_PENDING:\n      return { ...state,\n        fetching: true\n      };\n\n    case GET_COLLECTION_SUCCESS:\n      return { ...state,\n        fetching: false,\n        collection: action.payload\n      };\n\n    case GET_COLLECTION_ERROR:\n      return { ...state,\n        fetching: false,\n        error: action.payload\n      };\n\n    default:\n      return action;\n  }\n}; // ACTIONS\n\n\nexport const setFilterAction = filterType => dispatch => {\n  dispatch({\n    type: SET_FILTER,\n    payload: {\n      filter: filterType,\n      filterQuery: queries[filterType]\n    }\n  });\n  dispatch(clearInputAction());\n  dispatch(clearCollectionAction());\n  dispatch(setPageAction(1));\n};\nexport const setInputNameAction = inputName => dispatch => {\n  dispatch({\n    type: SET_NAME,\n    payload: inputName\n  });\n};\nexport const setInputTypeAction = inputType => dispatch => {\n  dispatch({\n    type: SET_TYPE,\n    payload: inputType\n  });\n};\nexport const clearInputAction = () => dispatch => {\n  dispatch({\n    type: CLEAR_INPUT\n  });\n};\nexport const clearCollectionAction = () => dispatch => {\n  dispatch({\n    type: CLEAR_COLLECTION\n  });\n  dispatch(clearErrorAction());\n};\nexport const clearErrorAction = () => dispatch => {\n  dispatch({\n    type: CLEAR_ERROR\n  });\n};\nexport const setPageAction = page => dispatch => {\n  dispatch({\n    type: SET_CURRENT_PAGE,\n    payload: page\n  });\n};\nexport const getCollectionAction = () => (dispatch, getState) => {\n  const {\n    filterQuery,\n    filter,\n    page,\n    inputName,\n    inputType\n  } = getState().searcher;\n  dispatch(clearCollectionAction());\n  const query = gql`${filterQuery}`;\n  dispatch({\n    type: GET_COLLECTION_PENDING\n  });\n  return client.query({\n    query,\n    variables: {\n      name: inputName.toLowerCase(),\n      type: inputType.toLowerCase(),\n      page: page\n    }\n  }).then(({\n    data\n  }) => {\n    dispatch({\n      type: GET_COLLECTION_SUCCESS,\n      payload: data[filter].results\n    });\n    dispatch({\n      type: SET_TOTAL_PAGES,\n      payload: data[filter].info.pages\n    });\n  }).catch(error => {\n    dispatch({\n      type: GET_COLLECTION_ERROR,\n      payload: error\n    });\n  });\n};\nexport default reducer;","map":{"version":3,"sources":["D:/React-Workspace/Puzzle/reactjs-challenge-marina/src/redux/searcherDuck.ts"],"names":["ApolloClient","gql","CLEAR_COLLECTION","CLEAR_ERROR","CLEAR_INPUT","Filter","GET_COLLECTION_ERROR","GET_COLLECTION_PENDING","GET_COLLECTION_SUCCESS","SET_CURRENT_PAGE","SET_FILTER","SET_NAME","SET_TOTAL_PAGES","SET_TYPE","client","uri","queries","characters","locations","episodes","initialData","filterQuery","filter","collection","inputType","inputName","fetching","error","page","totalPages","reducer","state","action","type","payload","setFilterAction","filterType","dispatch","clearInputAction","clearCollectionAction","setPageAction","setInputNameAction","setInputTypeAction","clearErrorAction","getCollectionAction","getState","searcher","query","variables","name","toLowerCase","then","data","results","info","pages","catch"],"mappings":"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","sourcesContent":["import ApolloClient, { gql } from 'apollo-boost';\r\nimport { Reducer } from 'redux';\r\nimport {\r\n    AppThunk,\r\n    CLEAR_COLLECTION, CLEAR_ERROR, CLEAR_INPUT, Filter,\r\n    GET_COLLECTION_ERROR, GET_COLLECTION_PENDING, GET_COLLECTION_SUCCESS,\r\n    SearcherActionTypes, SearcherState, SET_CURRENT_PAGE, SET_FILTER, SET_NAME, SET_TOTAL_PAGES, SET_TYPE\r\n} from './reduxTypes';\r\n\r\nlet client = new ApolloClient({\r\n    uri: \"https://rickandmortyapi.com/graphql\"\r\n})\r\n\r\n// GraphQL Queries\r\nconst queries = {\r\n    [Filter.characters]:  `\r\n        query($name:String,$type:String, $page:Int) {\r\n            characters(page:$page,filter:{name:$name, type:$type}){\r\n                info{\r\n                    pages\r\n                }\r\n                results{\r\n                    id\r\n                    name\r\n                    type\r\n                    species\r\n                    gender\r\n                    image\r\n                }\r\n            }\r\n        }`,\r\n\r\n    [Filter.locations]: `\r\n        query($name:String,$type:String, $page:Int) {\r\n            locations(page:$page,filter:{name:$name, type:$type}){\r\n                info{\r\n                    pages\r\n                }\r\n                results{\r\n                    id\r\n                    name\r\n                    dimension\r\n                    residents{\r\n                        name\r\n                        image\r\n                    }\r\n                }\r\n            }\r\n        }`,\r\n\r\n    [Filter.episodes]: `\r\n        query($name:String, $page:Int) {\r\n            episodes(page:$page,filter:{name:$name}){\r\n                info{\r\n                    pages\r\n                }\r\n                results{\r\n                    id\r\n                    name\r\n                    air_date\r\n                    episode\r\n                    characters{\r\n                    name\r\n                    image\r\n                    }\r\n                }\r\n            }\r\n        }`\r\n}\r\n\r\n// STATES\r\nconst initialData = {\r\n    filterQuery: '',\r\n    filter: Filter.characters, \r\n    collection: [],\r\n    inputType: '',\r\n    inputName: '',\r\n    fetching: false,\r\n    error:false,\r\n    page: 1,\r\n    totalPages: 0\r\n}\r\n\r\n// REDUCER\r\nconst reducer:Reducer<SearcherState> = ( state=initialData, action: SearcherActionTypes )  => {\r\n    switch (action.type) {\r\n        case SET_FILTER:\r\n            return {...state, ...action.payload }\r\n        case SET_NAME:\r\n            return { ...state, inputName: action.payload}\r\n        case SET_TYPE:\r\n            return { ...state, inputType: action.payload}\r\n        case CLEAR_INPUT:\r\n            return {...state, inputType:'', inputName:''}\r\n        case CLEAR_COLLECTION:\r\n            return {...state, collection:[], totalPages:0 }\r\n        case CLEAR_ERROR:\r\n            return {...state, error:false}\r\n        case SET_TOTAL_PAGES:\r\n            return {...state, totalPages: action.payload}\r\n        case SET_CURRENT_PAGE:\r\n            return {...state, page: action.payload}\r\n        case GET_COLLECTION_PENDING:\r\n            return {...state, fetching: true}\r\n        case GET_COLLECTION_SUCCESS:\r\n            return { ...state, fetching: false, collection: action.payload }\r\n        case GET_COLLECTION_ERROR:\r\n            return { ...state, fetching: false, error: action.payload }\r\n        default:\r\n            return action\r\n    }\r\n}\r\n \r\n// ACTIONS\r\nexport const setFilterAction: AppThunk = (filterType:Filter) => (dispatch) => {\r\n    dispatch({\r\n        type: SET_FILTER,\r\n        payload: { filter: filterType, filterQuery: queries[filterType as keyof typeof queries] }\r\n    })\r\n\r\n    dispatch(clearInputAction());\r\n\r\n    dispatch(clearCollectionAction());\r\n\r\n    dispatch(setPageAction(1));\r\n}\r\n\r\nexport const setInputNameAction: AppThunk = (inputName:string) => (dispatch) => {\r\n    dispatch({\r\n        type: SET_NAME,\r\n        payload: inputName\r\n    })\r\n} \r\n\r\nexport const setInputTypeAction: AppThunk = (inputType:string) => (dispatch) => {\r\n    dispatch({\r\n        type: SET_TYPE,\r\n        payload: inputType\r\n    })\r\n} \r\n\r\nexport const clearInputAction: AppThunk = () => (dispatch) => {\r\n    dispatch({\r\n        type: CLEAR_INPUT\r\n    })\r\n}\r\n\r\nexport const clearCollectionAction: AppThunk = () => (dispatch) => {\r\n    dispatch({\r\n        type: CLEAR_COLLECTION\r\n    })\r\n\r\n    dispatch(clearErrorAction());\r\n}\r\n\r\nexport const clearErrorAction: AppThunk = () => (dispatch) => {\r\n    dispatch({\r\n        type: CLEAR_ERROR\r\n    })\r\n}\r\n\r\nexport const setPageAction: AppThunk = (page: number) => (dispatch) => {\r\n    dispatch({\r\n        type: SET_CURRENT_PAGE,\r\n        payload: page\r\n    })\r\n}\r\n\r\nexport const getCollectionAction: AppThunk = () => (dispatch, getState) => {\r\n    const { filterQuery, filter, page, inputName, inputType } = getState().searcher;\r\n\r\n    dispatch(clearCollectionAction());\r\n\r\n    const query = gql`${filterQuery}`\r\n\r\n    dispatch({\r\n        type: GET_COLLECTION_PENDING,\r\n    })\r\n\r\n    return client.query({\r\n        query,\r\n        variables: { name:inputName!.toLowerCase(), type:inputType!.toLowerCase(), page:page }\r\n    })\r\n        .then(({ data }) => {\r\n            dispatch({\r\n                type: GET_COLLECTION_SUCCESS,\r\n                payload: data[filter!].results\r\n            })\r\n\r\n            dispatch({\r\n                type: SET_TOTAL_PAGES,\r\n                payload: data[filter!].info.pages\r\n            })\r\n        }).catch(error => {\r\n            dispatch({\r\n                type: GET_COLLECTION_ERROR,\r\n                payload: error\r\n            })\r\n        })\r\n}\r\n\r\nexport default reducer;"]},"metadata":{},"sourceType":"module"}